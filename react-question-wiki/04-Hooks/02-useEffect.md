# useEffect

## 副作用

函数组件：执行函数，返回 JSX
- 初次渲染时
- state 更新时

但有些场景需要如下功能
- 当渲染完成时，做某些事情
- 当某个 state 变化时，做某些事情
- 如 ajax 加载数据（state 变化重新加载）

如果只有 `执行函数，返回 JSX` 这个逻辑，无法满足上面的场景。

所以需要 useEffect

## 组件渲染完成时

代码演示：List2.tsx 使用 `useEffect` 模拟 ajax 请求

## 某些 state 更新时

代码演示：QuestionCard 监听 `isPublished` 的更新

## 组件销毁时

有创建就有销毁，有生就有死

代码演示：增加 `isDeleted` 属性和 `delete` 事件，看 QuestionCard 组件的销毁

【重要】如果有定时任务，或者 DOM 事件，组件销毁时一定要解绑

## 执行两次（销毁一次）

React18 开始，`useEffect` 在开发环境下执行两次 <br>
模拟组件挂载、销毁、重新挂载的完整流程，及早发现后续的问题。如果只挂载一次，有可能卸载组件时有问题。<br>
而且，实际项目中某些组件真的有可能会被挂载很多次（如重置 state），要及早模拟这种情况，避免出现重复挂载的问题（如弹窗重复、bindEvent 重复）

生产环境下，不会再执行两次
